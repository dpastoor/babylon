      SUBROUTINE MUMODEL2(THETA,MU_,ICALL,IDEF,NEWIND,&
      EVTREC,DATREC,IREV,NVNT,INDXS,F,G,H,IRGG,GG,NETAS)
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE NMBAYES_REAL,    ONLY: PRIORINFO
      USE PRDATA, ONLY: MXSTEP=>MXSTP01
      USE NMPRD_REAL,ONLY: ETA,EPS
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,COMACT,COMSAV,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE,NOFIRSTDERCODE
      USE NMPRD_REAL, ONLY: DV_LOQ,CDF_L,DV_LAQ,CDF_LA
      USE NMPRD_INT, ONLY: IQUIT
      USE PROCM_INT, ONLY: A_0FLG
      USE PRMOD_REAL,ONLY: A_0,DA_0,D2A_0
      USE NMBAYES_REAL, ONLY: LDF
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)
      REAL(KIND=DPSIZE)   :: MU_(*)
      INTEGER NEWIND
      REAL(KIND=DPSIZE) :: EVTREC
      SAVE
      INTEGER(KIND=ISIZE) :: FIRSTEM
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS,IRGG,NETAS
      DIMENSION :: IDEF(7,*),THETA(*),EVTREC(IREV,*),INDXS(*),GG(IRGG,GPKD+1,*)
      FIRSTEM=IFIRSTEM
      IF (ICALL <= 1) THEN
      CALL ASSOCNMPRD4
      IDEF(   1,0001)=  -9
      IDEF(   1,0002)=  -1
      IDEF(   1,0003)=   1
      IDEF(   1,0004)=   0
      IDEF(   2,0003)=   0
      IDEF(   2,0004)=   0
      CALL GETETA(ETA)
      IF (IQUIT == 1) RETURN
      RETURN
      ENDIF
      IF (NEWIND /= 2) THEN
      IF (ICALL == 4) THEN
      CALL SIMETA(ETA)
      ELSE
      CALL GETETA(ETA)
      ENDIF
      IF (IQUIT == 1) RETURN
      ENDIF
 !  level            0
      AGE=EVTREC(NVNT,008)
      WT=EVTREC(NVNT,009)
      CLCR=EVTREC(NVNT,010)
      POP_CL=THETA(001)
      POP_V1=THETA(002)
      POP_Q=THETA(003)
      POP_V2=THETA(004)
      COV_CL_AGE=THETA(005)
      COV_V1_WT=THETA(006)
      RUV_PROP=THETA(007)
      RUV_ADD=THETA(008)
      COV_CL_CLCR=THETA(009)
      ETA_CL=ETA(001)
      ETA_V1=ETA(002)
      ETA_Q=ETA(003)
      ETA_V2=ETA(004)
      B000001=WT/70.D0
      B000003=DLOG(B000001)
      LOGTWT=B000003
      B000004=AGE/35.D0
      B000006=DLOG(B000004)
      LOGTAGE=B000006
      B000007=CLCR/83.D0
      B000009=DLOG(B000007)
      LOGTCLCR=B000009
      B000010=DLOG(POP_CL)
      MU_1=B000010+COV_CL_AGE*LOGTAGE+COV_CL_CLCR*LOGTCLCR
      MU_(001)=MU_1
      B000011=MU_1+ETA(001)
      B000012=DEXP(B000011)
      CL=B000012
      B000013=DLOG(POP_V1)
      MU_2=B000013+COV_V1_WT*LOGTWT
      MU_(002)=MU_2
      B000014=MU_2+ETA(002)
      B000015=DEXP(B000014)
      V1=B000015
      MU_3=DLOG(POP_Q)
      MU_(003)=MU_3
      B000016=MU_3+ETA(003)
      B000017=DEXP(B000016)
      Q=B000017
      MU_4=DLOG(POP_V2)
      MU_(004)=MU_4
       RETURN
      B000018=MU_4+ETA(004)
      B000019=DEXP(B000018)
      V2=B000019
      IF(A_0FLG == 1)THEN
      A_0(1)=0.D0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(2)=0.D0
      ENDIF
      P000001=V1
      P000002=Q
      P000003=V2
      P000004=CL
      IF (FIRSTEM == 1) THEN
!                      A000042 = DERIVATIVE OF V1 W.R.T. ETA(002)
      A000042=B000015
!                      A000055 = DERIVATIVE OF P000001 W.R.T. ETA(002)
      A000055=A000042
!                      A000057 = DERIVATIVE OF P000002 W.R.T. ETA(003)
      A000057=B000017
!                      A000059 = DERIVATIVE OF P000003 W.R.T. ETA(004)
      A000059=B000019
!                      A000061 = DERIVATIVE OF P000004 W.R.T. ETA(001)
      A000061=B000012
      GG(0001,1,1)=P000001
      GG(0001,0003,1)=A000055
      GG(0002,1,1)=P000002
      GG(0002,0004,1)=A000057
      GG(0003,1,1)=P000003
      GG(0003,0005,1)=A000059
      GG(0004,1,1)=P000004
      GG(0004,0002,1)=A000061
      ELSE
      GG(0001,1,1)=P000001
      GG(0002,1,1)=P000002
      GG(0003,1,1)=P000003
      GG(0004,1,1)=P000004
      ENDIF
      IF (MSEC == 1) THEN
!                      A000044 = DERIVATIVE OF A000042 W.R.T. ETA(002)
      A000044=B000015
!                      A000056 = DERIVATIVE OF A000055 W.R.T. ETA(002)
      A000056=A000044
!                      A000058 = DERIVATIVE OF A000057 W.R.T. ETA(003)
      A000058=B000017
!                      A000060 = DERIVATIVE OF A000059 W.R.T. ETA(004)
      A000060=B000019
!                      A000062 = DERIVATIVE OF A000061 W.R.T. ETA(001)
      A000062=B000012
      GG(0001,0003,0003)=A000056
      GG(0002,0004,0004)=A000058
      GG(0003,0005,0005)=A000060
      GG(0004,0002,0002)=A000062
      ENDIF
      RETURN
      END
